#!/usr/bin/env sh

# Get current branch name
branch="$(git rev-parse --abbrev-ref HEAD)"

# Define valid branch name pattern
valid_branch_regex="^(feature|fix|hotfix|release|chore|docs|refactor|test)\/[a-z0-9._-]+$"

# Allow protected branches
if [ "$branch" = "main" ] || [ "$branch" = "develop" ]; then
    echo "✅ Pushing to protected branch: $branch (no naming validation)"
    exit 0
fi

# Validate branch name
if ! echo "$branch" | grep -qE "$valid_branch_regex"; then
    echo ""
    echo "❌ ERROR: Invalid branch name: '$branch'"
    echo ""
    echo "Branch names must follow this format:"
    echo "  <type>/<description>"
    echo ""
    echo "Valid types:"
    echo "  - feature/"
    echo "  - fix/"
    echo "  - hotfix/"
    echo "  - release/"
    echo "  - chore/"
    echo "  - docs/"
    echo "  - refactor/"
    echo "  - test/"
    echo ""
    echo "Example:"
    echo "  feature/user-authentication"
    echo ""
    echo "Rename your branch with:"
    echo "  git branch -m <type>/<description>"
    echo ""
    exit 1
fi

echo "✅ Branch name is valid: $branch"
exit 0
